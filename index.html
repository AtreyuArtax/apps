<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The Science Bench</title>
  <meta name="description" content="Interactive tools and simulations for physics, math, and beyond." />
  <meta name="color-scheme" content="light dark" />
  <link rel="icon" type="image/svg+xml" href='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><rect width="32" height="32" rx="6" fill="%232563eb"/><text x="16" y="22" text-anchor="middle" font-family="Inter, sans-serif" font-weight="800" font-size="16" letter-spacing="-1" fill="white">SB</text></svg>'>

  <style>
    /* ===== Theme tokens ===== */
    :root{
      --bg:#fafafa; --fg:#111; --muted:#666; --card:#fff; --border:#e6e6e6; --accent:#2563eb;
      --ring: color-mix(in oklab, var(--accent) 40%, white);
      --radius:16px; --gap:16px; --shadow:0 4px 16px rgba(0,0,0,.08);
      --control-h: 44px;
    }
    @media (prefers-color-scheme: dark){
      :root:not([data-theme]){
        --bg:#0f1115; --fg:#e7e9ee; --muted:#a2a7b3; --card:#171923; --border:#232634; --accent:#60a5fa;
        --ring: color-mix(in oklab, var(--accent) 30%, black); --shadow:0 4px 18px rgba(0,0,0,.35);
      }
    }
    :root[data-theme="light"]{
      --bg:#fafafa; --fg:#111; --muted:#666; --card:#fff; --border:#e6e6e6; --accent:#2563eb;
      --ring: color-mix(in oklab, var(--accent) 40%, white); --shadow:0 4px 16px rgba(0,0,0,.08);
    }
    :root[data-theme="dark"]{
      --bg:#0f1115; --fg:#e7e9ee; --muted:#a2a7b3; --card:#171923; --border:#232634; --accent:#60a5fa;
      --ring: color-mix(in oklab, var(--accent) 30%, black); --shadow:0 4px 18px rgba(0,0,0,.35);
    }

    html,body{ height:100%; }
    body{ margin:0; background:var(--bg); color:var(--fg); font:16px/1.5 Inter, ui-sans-serif, system-ui, Segoe UI, Roboto, Helvetica, Arial, Apple Color Emoji, Noto Color Emoji, sans-serif; }
    .wrap{ max-width:1100px; margin:auto; padding: clamp(16px, 4vw, 28px); }

    header{ display:grid; gap:12px; margin-block:20px 10px; align-items:center; grid-template-columns: 1fr auto auto; }
    .title{ font-size: clamp(22px, 2.2vw + 12px, 34px); font-weight:700; letter-spacing:.2px; grid-column:1; }
    .subtitle{ grid-column:1 / -1; color:var(--muted); margin-top:-6px; }
    .no-results{ grid-column: 1 / -1; display:none; }
    .header-btns { display: flex; gap: 8px; grid-column: 2 / 3; }

    .controls{ display:flex; flex-wrap:wrap; gap:12px; margin:12px 0 6px; align-items:center; }
    .search{ position:relative; flex:1 1 320px; min-width:260px; }
    .search input{
      width:100%; height: var(--control-h);
      padding: 0 44px 0 40px;
      border-radius:999px; border:1px solid var(--border); background:var(--card); color:var(--fg);
      box-shadow:var(--shadow);
    }
    .search svg{ position:absolute; left:12px; top:50%; transform:translateY(-50%); opacity:.7; }

    .toggle {
      border: none; background: transparent; box-shadow: none;
      padding: 4px; border-radius: 50%; color: var(--fg); cursor: pointer;
    }

    .filters{ display:flex; flex-wrap:wrap; gap:8px; align-items:center; }
    .chip{
      height: var(--control-h); line-height: calc(var(--control-h) - 2px);
      padding: 0 14px; border-radius:999px; border:1px solid var(--border);
      background:var(--card); color:var(--fg); cursor:pointer; user-select:none;
    }
    .chip[aria-pressed="true"]{ outline:2px solid var(--ring); border-color:transparent; }

    .grid{ display:grid; gap:var(--gap); grid-template-columns: repeat( auto-fit, minmax(260px, 1fr) ); margin-top:14px; }
    .card{
      background:var(--card); border:1px solid var(--border); border-radius:var(--radius);
      padding:16px; display:flex; flex-direction:column; gap:10px; box-shadow:var(--shadow);
      transition: transform .15s ease, box-shadow .15s ease, background .15s ease;
      cursor: default;
    }
    .card:focus-within, .card:hover{ transform: translateY(-2px); box-shadow: 0 8px 28px rgba(0,0,0,.12); }
    .card h3{ margin:0; font-size:18px; letter-spacing:.2px; }
    .card p{ margin:0; color:var(--muted); }
    .tags{ display:flex; flex-wrap:wrap; gap:6px; margin-top:2px; }
    .tag{ font-size:12px; padding:4px 8px; border-radius:999px; background: color-mix(in oklab, var(--accent) 12%, var(--card)); color: color-mix(in oklab, var(--accent) 70%, var(--fg)); border:1px solid color-mix(in oklab, var(--accent) 40%, var(--border)); }

    .actions{ margin-top:auto; display:flex; gap:8px; }
    .btn{ appearance:none; border:1px solid var(--border); background:var(--card); color:var(--fg); padding:10px 12px; border-radius:10px; cursor:pointer; text-decoration:none; text-align:center; }
    .btn.primary{ background:var(--accent); color:white; border-color:transparent; }
    .btn:focus{ outline:3px solid var(--ring); outline-offset:2px; }

    footer{ color:var(--muted); font-size:14px; text-align:center; margin:24px 0 12px; }

    /* Icon swapping by mode (auto | light | dark) */
    #modeIconAuto, #modeIconSun, #modeIconMoon { display: none; }
    #modeBtn[data-mode="auto"]  #modeIconAuto { display: inline; }
    #modeBtn[data-mode="light"] #modeIconSun  { display: inline; }
    #modeBtn[data-mode="dark"]  #modeIconMoon { display: inline; }

    .sr-only{
      position:absolute!important; width:1px!important; height:1px!important; padding:0!important; margin:-1px!important;
      overflow:hidden!important; clip:rect(0,0,0,0)!important; white-space:nowrap!important; border:0!important;
    }

    @media (prefers-reduced-motion: reduce){ .card{ transition:none } .card:hover{ transform:none } }

    /* ==== Card hover + drag visuals ==== */
    .drag-chosen { transform: scale(.995); box-shadow: 0 10px 32px rgba(0,0,0,.18); }
    .drag-ghost  { opacity: .35; }
    .card:hover  { background: color-mix(in oklab, var(--accent) 4%, var(--card)); }
    .card.drag-chosen { transform: scale(.98); box-shadow: 0 12px 32px rgba(0,0,0,.2); }

    /* Desktop-only drag handle */
    @media (hover: hover) and (pointer: fine){
      .card h3{
        cursor: move;
        user-select: none; -webkit-user-select: none;
        touch-action: none;
      }
    }

    /* Touch devices: normal scrolling & selection */
    @media (hover: none){
      .card { touch-action: auto; }
      .card h3{ cursor: default; user-select: text; -webkit-user-select: text; touch-action: auto; }
    }

    /* ==== Button hover harmony ==== */
    .btn{
      transition: background .15s ease, outline .15s ease, color .15s ease, transform .15s ease;
    }
    .btn:hover{
      outline: 2px solid var(--accent); outline-offset: 2px; transform: scale(1.02);
    }
    .btn.primary:hover{
      background: color-mix(in oklab, var(--accent) 85%, black);
      outline: 2px solid var(--accent); outline-offset: 2px; transform: scale(1.02);
    }

    /* ==== Modal and PWA Icon Styling ==== */
    dialog {
      padding: 1.5rem;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: var(--card);
      box-shadow: var(--shadow);
      max-width: 500px;
      max-height: 80vh;
      overflow: auto;
      color: var(--fg);
    }
    dialog::backdrop {
      background: rgba(0, 0, 0, 0.4);
    }
    dialog h2 {
      margin-top: 0;
    }
    dialog button {
      margin-top: 1rem;
    }
    .pwa-icon {
      font-size: 1rem;
      vertical-align: middle;
      cursor: help;
      display: inline-block;
      margin-left: 4px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <div class="title">The Science Bench</div>
        <div class="subtitle">Interactive tools and simulations for physics, math, and beyond.</div>
      </div>
      <div class="header-btns">
        <button id="infoBtn" class="toggle" title="How this works">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="16" x2="12" y2="12"></line>
            <line x1="12" y1="8" x2="12.01" y2="8"></line>
          </svg>
        </button>
        <button id="modeBtn" class="toggle" aria-pressed="false" title="Toggle theme (Auto/Light/Dark)">
          <svg id="modeIconAuto" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><rect x="3" y="4" width="18" height="12" rx="2" ry="2"></rect><line x1="8" y1="20" x2="16" y2="20"></line><line x1="12" y1="16" x2="12" y2="20"></line></svg>
          <svg id="modeIconSun"  width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
          <svg id="modeIconMoon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79Z"/></svg>
          <span class="sr-only" id="modeLabel">Auto</span>
        </button>
      </div>
      <div class="subtitle no-results" id="noResults">No matches. Try clearing filters or search.</div>
    </header>

    <div class="controls">
      <div class="search" role="search">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="11" cy="11" r="7"/><line x1="16.65" y1="16.65" x2="21" y2="21"/></svg>
        <label class="sr-only" for="q">Search</label>
        <input id="q" name="q" type="search" placeholder="Search simulations, topics, or tags… (⌘/Ctrl+K)" autocomplete="off" />
      </div>
      <div class="filters" role="toolbar" aria-label="Filter by category">
        <button class="chip" data-filter="all" aria-pressed="true">All</button>
        <button class="chip" data-filter="physics">Physics</button>
        <button class="chip" data-filter="math">Math</button>
        <button class="chip" data-filter="tools">Tools</button>
        <button class="chip" data-filter="lab">Labs</button>
      </div>
    </div>

    <main class="grid" id="grid" aria-live="polite">
      <article class="card" tabindex="0" data-category="physics" data-tags="kinematics graphs position-time velocity-time slope">
        <h3>Kinematics Calculator</h3>
        <p>A comprehensive web-based calculator for 1D/2D kinematics and projectiles.</p>
        <div class="tags"><span class="tag">Physics</span><span class="tag">Graphs</span></div>
        <div class="actions">
          <a class="btn primary" href="https://atreyuartax.github.io/kinematics_calculator" rel="noopener">Open</a>
          <a class="btn download-btn" data-raw="https://raw.githubusercontent.com/AtreyuArtax/kinematics_calculator/main/index.html" data-filename="kinematics_calculator.html">Download</a>
        </div>
      </article>
      <article class="card" tabindex="0" data-category="physics" data-tags="forces friction newton f=ma atwood incline">
        <h3>Newton’s 2nd Law Lab (Incline & Atwood)</h3>
        <p>Interactive <em>F = ma</em> scenarios with adjustable parameters and real-time plots.</p>
        <div class="tags"><span class="tag">Physics</span><span class="tag">Forces</span></div>
        <div class="actions">
          <a class="btn primary" href="https://atreyuartax.github.io/N2L-Pulley-Simulation/" rel="noopener">Open</a>
          <a class="btn download-btn" data-raw="https://raw.githubusercontent.com/AtreyuArtax/N2L-Pulley-Simulation/main/index.html" data-filename="newtons_second_law_lab.html">Download</a>
        </div>
      </article>
      <article class="card" tabindex="0" data-category="physics" data-tags="electricity equipotential field-lines mapping">
        <h3>Equipotential Mapping</h3>
        <p>Turn your grid of measured voltages into clear equipotential maps. Plot contours, inspect gradients, and export clean visuals for labs or reports.</p>
        <div class="tags"><span class="tag">Physics</span><span class="tag">Electricity</span></div>
        <div class="actions">
          <a class="btn primary" href="https://atreyuartax.github.io/equipotential_mapping/" rel="noopener">Open</a>
          <a class="btn download-btn" data-raw="https://raw.githubusercontent.com/AtreyuArtax/equipotential_mapping/main/index.html" data-filename="equipotential_mapper.html">Download</a>
        </div>
      </article>
      <article class="card" tabindex="0" data-category="math" data-tags="algebra factoring solving quadratics lines inequalities">
        <h3>Grids.</h3>
        <p>SVG grid generator + equation/inequality plotting with clean exports.</p>
        <div class="tags"><span class="tag">Physics</span><span class="tag">Tools</span><span class="tag">Math</span><span class="tag">Graphing</span></div>
        <div class="actions"><a class="btn primary" href="https://atreyuartax.github.io/grids/" rel="noopener">Open</a></div>
      </article>
      <article class="card" tabindex="0" data-category="tools" data-tags="assessment generator worksheets randomizer bingo">
        <h3>Element Bingo</h3>
        <p>Run Element Bingo and generate printable cards entirely in the browser.</p>
        <div class="tags"><span class="tag">Tools</span></div>
        <div class="actions">
          <a class="btn primary" href="https://atreyuartax.github.io/element_bingo/" rel="noopener">Open</a>
          <a class="btn download-btn" data-raw="https://raw.githubusercontent.com/AtreyuArtax/element_bingo/main/index.html" data-filename="element_bingo.html">Download</a>
        </div>
      </article>
      <article class="card" tabindex="0" data-category="lab" data-tags="ramp projectile experiment kinematics">
        <h3>Projectile Simulation — Ramps</h3>
        <p>Ramp → table → projectile; explore kinematics and dynamics.</p>
        <div class="tags"><span class="tag">Physics</span><span class="tag">Lab</span></div>
        <div class="actions">
          <a class="btn primary" href="https://atreyuartax.github.io/Ramp-Projectile-Simulator/" rel="noopener">Open</a>
          <a class="btn download-btn" data-raw="https://raw.githubusercontent.com/AtreyuArtax/Ramp-Projectile-Simulator/main/index.html" data-filename="ramp_projectile_simulator.html">Download</a>
        </div>
      </article>
      <article class="card" tabindex="0" data-category="lab" data-tags="friction static kinetic materials">
        <h3>Friction Simulator</h3>
        <p>Select materials and masses; visualize static peak and kinetic average.</p>
        <div class="tags"><span class="tag">Physics</span><span class="tag">Lab</span></div>
        <div class="actions">
          <a class="btn primary" href="https://atreyuartax.github.io/friction_simulator/" rel="noopener">Open</a>
          <a class="btn download-btn" data-raw="https://raw.githubusercontent.com/AtreyuArtax/friction_simulator/main/index.html" data-filename="friction_simulation.html">Download</a>
        </div>
      </article>
      <article class="card" tabindex="0" data-category="tools" data-tags="motion kinetic graphs">
        <h3>Motion Graphs</h3>
        <p>Create motion graphs and visualize the area under the curves. Plot ith points or a slope.</p>
        <div class="tags"><span class="tag">Physics</span><span class="tag">Tools</span></div>
        <div class="actions">
          <a class="btn primary" href="https://atreyuartax.github.io/motion_graphs/" rel="noopener">Open</a>
        </div>
      </article>
    </main>

    <footer>
      <div id="count"></div>
      <div id="updated"></div>
    </footer>
  </div>

  <dialog id="infoModal">
    <h2>How This Works</h2>
    <p>This is a collection of single-page apps for science and math. You can use them in two ways:</p>
    <ul>
      <li>
        <strong>Online:</strong> Click the "Open" button to run the app directly from your browser. This is the simplest option and ensures you always have the latest version.
      </li>
      <li>
        <strong>Offline:</strong> Many apps offer a "Download" button. This downloads the app's HTML file, allowing you to run it locally by opening the file in your browser. This is useful for offline use, but note that the local version will **not** receive automatic updates.
      </li>
    </ul>
    <p>The "Grids." app can be installed as a Progressive Web App (PWA) on supported browsers for easy access and a dedicated window. Just look for the install icon in your browser's address bar.</p>
    <button id="closeModal">Got it</button>
  </dialog>

  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"></script>
  <script>
    // ===== Light/Dark Mode Toggle (with saved preference) =====
    const modeBtn = document.getElementById('modeBtn');
    const modeLabel = document.getElementById('modeLabel');
    const MODE_KEY = 'pmhub-mode'; // 'light' | 'dark' | 'auto'

    function applyMode(mode){
      modeBtn.dataset.mode = mode;
      if(mode==='light'){
        document.documentElement.setAttribute('data-theme','light');
        document.documentElement.style.colorScheme='light';
        modeLabel.textContent='Light';
        modeBtn.setAttribute('aria-pressed','true');
      } else if(mode==='dark'){
        document.documentElement.setAttribute('data-theme','dark');
        document.documentElement.style.colorScheme='dark';
        modeLabel.textContent='Dark';
        modeBtn.setAttribute('aria-pressed','true');
      } else {
        document.documentElement.removeAttribute('data-theme');
        document.documentElement.style.colorScheme='light dark';
        modeLabel.textContent='Auto';
        modeBtn.setAttribute('aria-pressed','false');
      }
    }
    function cycleMode(){
      const current = localStorage.getItem(MODE_KEY) || 'auto';
      const next = current==='auto' ? 'light' : current==='light' ? 'dark' : 'auto';
      localStorage.setItem(MODE_KEY, next);
      applyMode(next);
    }
    modeBtn.addEventListener('click', cycleMode);
    applyMode(localStorage.getItem(MODE_KEY) || 'auto');

    // ===== Keyboard shortcut for search =====
    const q = document.getElementById('q');
    addEventListener('keydown', (e)=>{
      if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='k'){ e.preventDefault(); q.focus(); q.select(); }
    });

    // ===== Filtering & Search =====
    const chips = Array.from(document.querySelectorAll('.chip'));
    const grid = document.getElementById('grid');
    const cards = Array.from(grid.querySelectorAll('.card'));
    const noResults = document.getElementById('noResults');

    let activeFilter = 'all';
    chips.forEach(ch => ch.addEventListener('click', () => {
      chips.forEach(c => c.setAttribute('aria-pressed', 'false'));
      ch.setAttribute('aria-pressed', 'true');
      activeFilter = ch.dataset.filter;
      runFilter();
    }));
    q.addEventListener('input', runFilter);

    function runFilter(){
      const term = q.value.trim().toLowerCase();
      let shown = 0;
      cards.forEach(card => {
        const cat = card.dataset.category;
        const hay = (card.textContent + ' ' + (card.dataset.tags||'')).toLowerCase();
        const matchCat = (activeFilter==='all') || (cat===activeFilter);
        const matchTerm = !term || hay.includes(term);
        const visible = matchCat && matchTerm;
        card.style.display = visible ? '' : 'none';
        if(visible) shown++;
      });
      noResults.style.display = shown? 'none' : '';
      document.getElementById('count').textContent = `${shown} item${shown===1?'':'s'} shown`;
    }

    // Initial counts
    document.getElementById('count').textContent = `${cards.length} items`;
    document.getElementById('updated').textContent = `Last updated: ${new Date().toLocaleDateString(undefined,{year:'numeric',month:'short',day:'numeric'})}`;

    // ===== Helper: open card with Enter key =====
    cards.forEach(card => card.addEventListener('keydown', (e)=>{
      if(e.key==='Enter'){
        const primary = card.querySelector('.btn.primary');
        if(primary) primary.click();
      }
    }));

    // ===== Robust cross-repo downloads: fetch → Blob → save =====
    document.querySelectorAll('.download-btn').forEach(btn => {
      btn.addEventListener('click', async (e) => {
        e.preventDefault();
        const url = btn.dataset.raw;
        const filename = btn.dataset.filename || 'download.html';
        if (!url) return;
        const originalText = btn.textContent;
        btn.textContent = 'Downloading…';
        btn.setAttribute('aria-busy','true');
        btn.style.pointerEvents = 'none';
        try {
          const res = await fetch(url, { mode: 'cors' });
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          const blob = await res.blob();
          const dl = document.createElement('a');
          dl.href = URL.createObjectURL(blob);
          dl.download = filename;
          document.body.appendChild(dl);
          dl.click();
          setTimeout(() => { URL.revokeObjectURL(dl.href); dl.remove(); }, 1500);
        } catch (err) {
          window.open(url, '_blank', 'noopener');
        } finally {
          btn.textContent = originalText;
          btn.removeAttribute('aria-busy');
          btn.style.pointerEvents = '';
        }
      });
    });

    // ----- Elegant reorder with SortableJS (desktop only) -----
    (function () {
      const grid = document.getElementById('grid');
      const STORAGE_KEY = 'pmhub-card-order';

      // Desktop pointer guard
      const isDesktopPointer = matchMedia('(hover: hover) and (pointer: fine)').matches;
      if (!isDesktopPointer) return;

      // Ensure stable ids
      [...grid.querySelectorAll('.card')].forEach((card, i) => {
        if (!card.id) {
          const t = (card.querySelector('h3')?.textContent || `card-${i}`).trim()
            .toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '');
          card.id = t || `card-${i}`;
        }
        card.setAttribute('data-id', card.id);
      });

      // Restore saved order
      try {
        const saved = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
        if (Array.isArray(saved) && saved.length) {
          const map = Object.fromEntries([...grid.children].map(el => [el.id, el]));
          saved.forEach(id => { if (map[id]) grid.appendChild(map[id]); });
        }
      } catch {}

      // Init Sortable
      new Sortable(grid, {
        animation: 150,
        ghostClass: 'drag-ghost',
        chosenClass: 'drag-chosen',
        dragClass: 'dragging',
        handle: 'h3',
        filter: '.actions a, .actions .btn',
        preventOnFilter: true,
        fallbackTolerance: 3,
        fallbackOnBody: true,
        forceFallback: false,
        store: {
          get: () => JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]'),
          set: sortable => {
            const order = sortable.toArray();
            localStorage.setItem(STORAGE_KEY, JSON.stringify(order));
          }
        }
      });
    })();

    // ===== Modal and Info Button Functionality =====
    const infoBtn = document.getElementById('infoBtn');
    const infoModal = document.getElementById('infoModal');
    const closeModal = document.getElementById('closeModal');

    infoBtn.addEventListener('click', () => {
      infoModal.showModal();
    });

    closeModal.addEventListener('click', () => {
      infoModal.close();
    });
  </script>
</body>
</html>